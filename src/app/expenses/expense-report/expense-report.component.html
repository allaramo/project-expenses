<mat-card *ngIf="searchComplete">
  <!-- if the flag of loading is active shows the spinner -->
  <mat-spinner *ngIf="isLoading"></mat-spinner>
  <mat-card-title>PROJECT EXPENSES REPORT</mat-card-title>
  <!-- new item button that redirects to the creating screen -->
  <form
  (submit)="searchData(expForm)"
  #expForm="ngForm"
  *ngIf="!isLoading">
    <mat-form-field>
      <mat-label>Choose an initial date</mat-label>
      <input matInput [matDatepicker]="idate" [(ngModel)]="initialDate" name="idate" required>
      <mat-datepicker-toggle matSuffix [for]="idate"></mat-datepicker-toggle>
      <mat-datepicker #idate></mat-datepicker>
      <mat-error >Please enter a date</mat-error>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Choose a final date</mat-label>
      <input matInput [matDatepicker]="fdate" [(ngModel)]="finalDate" name="fdate" required>
      <mat-datepicker-toggle matSuffix [for]="fdate"></mat-datepicker-toggle>
      <mat-datepicker #fdate></mat-datepicker>
      <mat-error >Please enter a date</mat-error>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Select Category</mat-label>
      <mat-select name="category" [(ngModel)]="category" (ngModelChange)="onChangeCat($event)">
        <mat-option  *ngFor="let category of categoryList" [value]="category">{{category.name}}</mat-option>
      </mat-select>
      <mat-error >Please select a Category</mat-error>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Select Subcategory</mat-label>
      <mat-select name="subcategory">
        <mat-option  *ngFor="let subcategory of subcategoryList" [value]="subcategory">{{subcategory.name}}</mat-option>
      </mat-select>
      <mat-error >Please select a Subcategory</mat-error>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Select Project</mat-label>
      <mat-select name="project" [(ngModel)]="project" (ngModelChange)="onChangePro($event)">
        <mat-option  *ngFor="let project of projectList" [value]="project">{{project.name}}</mat-option>
      </mat-select>
      <mat-error >Please select a Project</mat-error>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Select Phase</mat-label>
      <mat-select name="phase">
        <mat-option  *ngFor="let phase of phaseList" [value]="phase.phase">{{phase.phase.description}} ({{ phase.project.name }})</mat-option>
      </mat-select>
      <mat-error >Please select a Phase</mat-error>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Select User</mat-label>
      <mat-select name="user">
        <mat-option  *ngFor="let user of userList" [value]="user">{{user.email}}</mat-option>
      </mat-select>
      <mat-error >Please select a User</mat-error>
    </mat-form-field>
    <mat-card-actions>
      <!-- displays search button -->
      <button
      mat-raised-button
      color="primary"
      type="submit"><mat-icon>search</mat-icon> SEARCH</button>
    </mat-card-actions>
  </form>
</mat-card>
<mat-card>
  <!-- if the flag of loading is active shows the spinner -->
  <mat-spinner *ngIf="isLoading"></mat-spinner>
  <mat-card-title>PROJECT EXPENSES REPORT</mat-card-title>
  <div>
    <table *ngFor="let pro of expenses">
        <tr class="project">
          <th>Project</th>
          <th>Description</th>
          <th>Status</th>
          <th>Budget %</th>
          <th>Budget</th>
          <th>Total Spent</th>
          <th>Spent %</th>
        </tr>
        <tr>
          <td>{{pro["project"]}}</td>
          <td>{{pro["description"]}}</td>
          <td>{{pro["status"]}}</td>
          <td>100%</td>
          <td>{{pro["budget"]}}</td>
          <td>{{pro["total"]}}</td>
          <td>{{pro["spent"]}}</td>
        </tr>
        <tbody *ngFor="let pha of pro['phases']">
          <tr class="phase">
            <th>Order</th>
            <th>Phase</th>
            <th>Status</th>
            <th>Budget %</th>
            <th>Budget</th>
            <th>Total Spent</th>
            <th>Spent %</th>
          </tr>
          <tr>
            <td>{{pha["order"]}}</td>
            <td>{{pha["phase"]}}</td>
            <td>{{pha["status"]}}</td>
            <td>{{pha["percentage"]}}</td>
            <td>{{pha["budget"]}}</td>
            <td>{{pha["total"]}}</td>
            <td>{{pha["spent"]}}</td>
          </tr>
          <tr class="expense">
            <th></th>
            <th>Date</th>
            <th>Category</th>
            <th>Subcategory</th>
            <th>User</th>
            <th>Total Spent</th>
            <th>Spent %</th>
          </tr>
          <tr *ngFor="let exp of pha['expenses']">
            <td></td>
            <td>{{exp["date"]}}</td>
            <td>{{exp["category"]}}</td>
            <td>{{exp["subcategory"]}}</td>
            <td>{{exp["user"]}}</td>
            <td>{{exp["total"]}}</td>
            <td>{{exp["spent"]}}</td>
          </tr>
        </tbody>
    </table>
  </div>
</mat-card>


